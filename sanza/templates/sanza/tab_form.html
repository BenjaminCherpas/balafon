{% extends "colorbox/popup_form_base.html" %}
{% load i18n %}

{% block extra_head %}
{{ block.super }}
<link type="text/css" href="{{ STATIC_URL }}css/chosen-bootstrap.css" rel="Stylesheet" />
<script>
  $(document).bind('cbox_complete', function(){
    $(document).unbind('cbox_complete');
    try {
        $(".chosen-select").chosen({disable_search: false, width: "100%"});
    } catch(e) {
        //silence
    }
    
    var error_index = -1;
    $("form fieldset").each(function(idx, elt) {
      $(elt).addClass('item'+idx);
      var err_cls = "";
      if ($(elt).find('.field-error').length>0) {
        if (error_index==-1) {
          error_index = idx;
        }
        var err_cls = "error";  
      }
      $(".tabbar").append('<span class="tab '+err_cls+'" rel="item'+idx+'">'+$(elt).find('legend').text()+'</span>');
      
    });
    parent.$.colorbox.resize({width: "60%"});
    $(".tabbar .tab").live('click', function() {
      var item = $(this).attr('rel');
      $(this).siblings().removeClass("selected");
      $(this).addClass("selected");
      $("fieldset").hide();
      $("fieldset."+item).show();
      parent.$.colorbox.resize(/*{width:x, height:y}*/);
    })
    if (error_index>0) {
      $(".tabbar .tab[rel=item"+error_index+"]").click();  
    } else {
      $(".tabbar .tab:first").click();  
    }
  });
</script>  
{% endblock %}

{% block form_fields %}
  
  <div class="doc-header">
  {% block doc_header %}
  {% endblock %}
  {% if form.errors %}
  <div class="pull-right error-msg label label-danger">{% trans "The form is not valid." %}</div>
  {% endif %}
  </div>

  
      
  <div class="tabbar"></div>
    <div class="tabbar-form">
        {% if form.non_field_errors %}{{ form.non_field_errors }}{% endif %}
          {% for fieldset in form.fieldsets %}
            <fieldset class="{{ fieldset.classes }}">
            {% if fieldset.legend %}
              <legend>{{ fieldset.legend }}</legend>
            {% endif %}
            {% if fieldset.description %}
              <p class="description">{{ fieldset.description }}</p>
            {% endif %}
            <div class="fieldsets">
            {% for field in fieldset %}
              {% include "sanza/_field_form.html" %}
            {% endfor %}
            </div>
            </fieldset>
          {% endfor %}
    </div>
    {% block doc_footer %}
    {% endblock %}

{% endblock %}

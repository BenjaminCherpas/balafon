{% extends "base.html" %}
{% load i18n %}

{% block extra_head %}
{{block.super}}
{{form.media}}
<style>
  .chzn-container-multi .chzn-choices .search-choice .search-choice-close {
    height: 8px;
  }
  .chzn-container-multi .chzn-choices .search-field input {
    height: 27px;
  }
  table.import-data {
    font-size: x-small;
  }
  table.import-data td {
    border: solid thin #aaa;
  }
  .exists {
    background: #ccc;
  }
  .not-exists {
    background: #f93;
  }
  .default-dep {
    background: #f44;
  }
</style>
{% endblock %}

{% block document_content %}
  <h2>{% trans "Confirm contacts import" %}</h2>
  <form method="POST" action="" enctype="multipart/form-data">{% csrf_token %}
    <div class="buttons">
    <input type="submit" value="{% trans "Confirm"%}">
    <a href="{{cancel_url}}">{% trans "Cancel" %}</a>
    </div>
    <ul>
      {{form.as_ul}}
      
      {% if not contacts %}
      <div class="help-message" style="margin-top: 20px; background: #f83;">
        {% blocktrans %}No new contacts to import ({{total_contacts }} in csv file){% endblocktrans %}
      </div>
      {% else %}
      <div class="help-message" style="margin-top: 20px">
        {% blocktrans %}It imports only contacts if their email doesn't already exists
        ({{nb_contacts}} on {{total_contacts }} in csv file)<br/><br/>
        <b>Caption:</b><br />
        * Gray background : Already exists<br />
        * Orange background : will be created<br />
        * Red background : The city will be created with default department as parent<br />
        {% endblocktrans %}
      </div>
      
      <table class="import-data">
        <tr>
          <th>{% trans "Entity" %}</th><th>{% trans "Gender" %}</th><th>{% trans "Lastname" %}</th>
          <th>{% trans "Firstname" %}</th><th>{% trans "Email" %}</th><th>{% trans "Entity city" %}</th>
          <th>{% trans "Contact city" %}</th><th>{% trans "Groups" %}</th><th>{% trans "Roles" %}</th>
        </tr>
      {% for c in contacts %}
        <tr>
          <td class="{% if c.entity_exists %}exists{% else %}not-exists{% endif %}">{{c.entity}}</td>
          
          <td>{{c.get_gender_display|default:"&nbsp;"}}</td>
          <td>{{c.lastname|default:"&nbsp;"}}</td>
          <td>{{c.firstname|default:"&nbsp;"}}</td>
          <td>{{c.email|default:"&nbsp;"}}</td>
          
          {% if c.entity_city %}
            {% if c.entity_city_exists %}
              <td class="exists">{{c.entity_city}}</td>
            {% else %}
              {% if c.entity_zip_code %}
                <td class="not-exists">{{c.entity_city}} ({{c.entity_zip_code|slice:":2"}})</td>
              {% else %}
                <td class="not-exists default-dep">{{c.entity_city}}</td>
              {% endif %}
            {% endif %}
          {% else %}
            <td>&nbsp;</td>
          {% endif %}
          
          {% if c.city %}
            {% if c.city_exists %}
              <td class="exists">{{c.city}}</td>
            {% else %}
              {% if c.zip_code %}
                <td class="not-exists">{{c.city}} ({{c.zip_code|slice:":2"}})</td>
              {% else %}
                <td class="not-exists default-dep">{{c.city}}</td>
              {% endif %}
            {% endif %}
          {% else %}
            <td>&nbsp;</td>
          {% endif %}

          {% if c.entity_groups %}
            <td>
              {% for g in c.entity_groups %}
              <span class="{% if g.exists %}exists{% else %}not-exists{% endif %}">
                {{g.name}}
              </span>
              {% if not forloop.last %};{% endif %}
              {% endfor %}
            </td>
          {% else %}
            <td>&nbsp;</td>
          {% endif %}
          
          {% if c.roles %}
            <td>
              {% for r in c.roles %}
              <span class="{% if r.exists %}exists{% else %}not-exists{% endif %}">
                {{r.name}}
              </span>
              {% if not forloop.last %};{% endif %}
              {% endfor %}
            </td>
          {% else %}
            <td>&nbsp;</td>
          {% endif %}
          
        </tr>
      {% endfor %}
      </table>
      {% endif %}
      </ul>
  </form>
  <script type="text/javascript"> $(".chzn-select").chosen();</script>
{% endblock %}
